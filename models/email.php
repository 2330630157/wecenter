<?php/*+--------------------------------------------------------------------------|   Anwsion [#RELEASE_VERSION#]|   ========================================|   by Anwsion dev team|   (c) 2011 - 2012 Anwsion Software|   http://www.anwsion.com|   ========================================|   Support: zhengqiang@gmail.com|   +---------------------------------------------------------------------------*/if (!defined('IN_ANWSION')){	die;}class email_class extends AWS_MODEL{	/*	FOLLOW_ME // 有人关注的了我	QUESTION_INVITE // 有人邀请我回复问题	NEW_ANSWER // 我关注的问题有新回复	NEW_MESSAGE // 有人向我发送私信	VALID_EMAIL // 验证邮箱	INVITE_REG // 邀请注册	FIND_PASSWORD // 找回密码	QUESTION_SHARE // 分享问题	ANSWER_SHARE // 分享回复	INVITE_QUESTION // 站外邀请	TOPIC_SHARE // 分享话题	QUESTION_MOD // 问题被修改	QUESTION_DEL // 问题被删除	*/		function action_email($action, $uid, $link, $data = array())	{		if (!H::valid_email($uid))		{			$user_info = $this->model('account')->get_user_info_by_uid($uid);						if ($user_info['email_settings'][$action] == 'N')			{				return false;			}		}				$email_message = (array)AWS_APP::config()->get('email_message');				foreach ($email_message[$action] as $key => $val)		{			$$key = str_replace('[#user_name#]', $data['user_name'], $val);			$$key = str_replace('[#site_name#]', get_setting('site_name'), $$key);			$$key = str_replace('[#question_title#]', $data['question_title'], $$key);						if (preg_match('/question_detail/i', $$key))			{				$$key = str_replace('[#question_detail#]', $data['question_detail'], $$key);			}		}				return $this->send($uid, $subject, $message, $link, $link_title);	}	/**     * 发送邮件     */	function send($uid, $subject, $message, $link = null, $link_title = null)	{		if (H::valid_email($uid))		{			$email = $uid;		}		else if (is_numeric($uid))		{						if (! $user_info = $this->model('account')->get_user_info_by_uid($uid))			{				return false;			}						$username = $user_info['user_name'];			$email = $user_info['email'];		}		else		{			return false;		}				TPL::assign('username', $username);		TPL::assign('subject', $subject);		TPL::assign('message', $message);		TPL::assign('link', $link);		TPL::assign('link_title', $link_title);				return load_class('core_mail')->send_mail(null, get_setting('site_name'), $email, $username, $subject, TPL::output('global/email_template', false));	}}