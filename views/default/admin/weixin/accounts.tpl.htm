<?php TPL::output('admin/global/header.tpl.htm'); ?>
<?php TPL::output('admin/global/nav_menu.tpl.htm'); ?>

<form action="admin/ajax/weixin_save_accounts/" id="accounts_form" method="post" onsubmit="return false">
    <?php if ($this->accounts_total != 0) { foreach ($this->accounts_list AS $key => $value) { ?>
    <div class="aw-content-wrap wechat wechat<?php echo $key + 1?>">
        <div class="mod">
        <div class="mod-head">
            <span class="pull-left"><?php _e('微信账号 %s', $key + 1); ?> (ID: <?php echo $value['id']; ?>)</span>

            <span class="pull-right">
                <a href="javascript:;" onclick="AWS.ajax_post($('#accounts_form'));" class="btn btn-xs btn-primary mod-site-save"><?php _e('快速保存'); ?></a>
                <a href="admin/weixin/mp_menu/id-<?php echo $value['id']; ?>" class="btn btn-xs btn-primary mod-site-save"><?php _e('菜单管理'); ?></a>
                <a href="javascript:;" onclick="AWS.ajax_request(G_BASE_URL + '/admin/ajax/weixin_remove_account/', 'id=<?php echo $value['id']; ?>');" class="btn btn-xs btn-primary mod-site-save"><?php _e('删除账号'); ?></a>
            </span>

            <input type="hidden" name="id[<?php echo $key; ?>]" value="<?php echo $value['id']; ?>" />
        </div>

        <div class="tab-content mod-content">
            <table class="table table-striped">
                <tr>
                    <td>
                        <div class="form-group">
                            <span class="col-sm-4 col-xs-3 control-label"><?php _e('微信公众平台接口 Token'); ?>:</span>
                            <div class="col-sm-5 col-xs-8">
                                <input type="text" class="form-control" name="weixin_mp_token[<?php echo $key; ?>]" value="<?php echo $value['weixin_mp_token']; ?>">
                                <span class="help-block"><?php _e('请与微信公众平台后台设置一致'); ?></span>
                            </div>
                        </div>
                    </td>
                </tr>

                <tr>
                    <td>
                        <div class="form-group">
                            <span class="col-sm-4 col-xs-3 control-label"><?php _e('微信公众平台帐号角色'); ?>:</span>
                            <div class="col-sm-8 col-xs-8">
                                <label class="checkbox-inline"
                                >
                                    <input type="radio" name="weixin_account_role[<?php echo $key; ?>]" value="base"<?php if ($value['weixin_account_role'] == 'base') { ?> checked="checked"<?php } ?> /> <?php _e('普通订阅号'); ?>
                                </label>

                                <label class="checkbox-inline">
                                    <input type="radio" name="weixin_account_role[<?php echo $key; ?>]" value="subscription"<?php if ($value['weixin_account_role'] == 'subscription') { ?> checked="checked"<?php } ?> /> <?php _e('微信认证订阅号'); ?>
                                </label>

                                <label class="checkbox-inline">
                                    <input type="radio" name="weixin_account_role[<?php echo $key; ?>]" value="general"<?php if ($value['weixin_account_role'] == 'general') { ?> checked="checked"<?php } ?> /> <?php _e('普通服务号'); ?>
                                </label>

                                <label class="checkbox-inline">
                                    <input type="radio" name="weixin_account_role[<?php echo $key; ?>]" value="service"<?php if ($value['weixin_account_role'] == 'service') { ?> checked="checked"<?php } ?> /> <?php _e('微信认证服务号'); ?>
                                </label>
                            </div>
                        </div>
                    </td>
                </tr>

                <tr>
                    <td>
                        <div class="form-group">
                            <span class="col-sm-4 col-xs-3 control-label"><?php _e('WeCenter 微信服务 Access token'); ?>:</span>
                            <div class="col-sm-5 col-xs-8">
                                <input type="text" class="form-control" name="wecenter_access_token[<?php echo $key; ?>]" value="<?php echo $value['wecenter_access_token']; ?>">
                                <span class="help-block"><?php _e('请到 %s 申请', '<a href="http://mp.wecenter.com" target="_blank">http://mp.wecenter.com</a>'); ?></span>
                            </div>
                        </div>
                    </td>
                </tr>

                <tr>
                    <td>
                        <div class="form-group">
                            <span class="col-sm-4 col-xs-3 control-label"><?php _e('WeCenter 微信服务 Access token'); ?>:</span>
                            <div class="col-sm-5 col-xs-8">
                                <input type="text" class="form-control" name="wecenter_access_token[<?php echo $key; ?>]" value="<?php echo $value['wecenter_access_token']; ?>">
                            </div>
                        </div>
                    </td>
                </tr>

                <tr>
                    <td>
                        <div class="form-group">
                            <span class="col-sm-4 col-xs-3 control-label"><?php _e('WeCenter 微信服务 Access secret'); ?>:</span>
                            <div class="col-sm-5 col-xs-8">
                                <input type="text" class="form-control" name="wecenter_access_secret[<?php echo $key; ?>]" value="<?php echo $value['wecenter_access_secret']; ?>">
                            </div>
                        </div>
                    </td>
                </tr>

                <tr>
                    <td>
                        <div class="form-group">
                            <span class="col-sm-4 col-xs-3 control-label"><?php _e('微信公众平台 AppID'); ?>:</span>
                            <div class="col-sm-5 col-xs-8">
                                <input type="text" class="form-control" name="weixin_app_id[<?php echo $key; ?>]" value="<?php echo $value['weixin_app_id']; ?>">
                            </div>
                        </div>
                    </td>
                </tr>

                <tr>
                    <td>
                        <div class="form-group">
                            <span class="col-sm-4 col-xs-3 control-label"><?php _e('微信公众平台 AppSecret'); ?>:</span>
                            <div class="col-sm-5 col-xs-8">
                                <input type="text" class="form-control" name="weixin_app_secret[<?php echo $key; ?>]" value="<?php echo $value['weixin_app_secret']; ?>">
                            </div>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
        </div>
    </div>
    <?php } } ?>
    <div class="aw-content-wrap wechat1">
    </div>
</form>


<div class="aw-content-wrap mod-wechat-btn">
    <div class="mod-wechat-sava center-block">
        <input type="button" value="<?php _e('新增'); ?>" class="btn btn-primary" id="newChat"/>
        <input type="button" value="<?php _e('保存'); ?>" class="btn btn-primary" onclick="AWS.ajax_post($('#accounts_form'));" />
    </div>
</div>

<div class="wechat-hide" style="display: none">
<div class="mod">
    <div class="mod-head">
        <span class="pull-left"><?php _e('微信账号'); ?></span>

        <span class="pull-right">
            <a href="javascript:;" onclick="AWS.ajax_post($('#accounts_form'));" class="btn btn-xs btn-primary mod-site-save"><?php _e('快速保存'); ?></a>
        </span>

        <input type="hidden" name="id[]" value="" />
    </div>

    <div class="tab-content mod-content">
    <table class="table table-striped">
        <tr>
            <td>
                <div class="form-group">
                    <span class="col-sm-4 col-xs-3 control-label"><?php _e('微信公众平台接口 Token'); ?>:</span>
                    <div class="col-sm-5 col-xs-8">
                        <input type="text" class="form-control" name="weixin_mp_token[]" value="">
                        <span class="help-block"><?php _e('请与微信公众平台后台设置一致'); ?></span>
                    </div>
                </div>
            </td>
        </tr>

        <tr>
            <td>
                <div class="form-group">
                    <span class="col-sm-4 col-xs-3 control-label"><?php _e('微信公众平台帐号角色'); ?>:</span>
                    <div class="col-sm-8 col-xs-8">
                        <label class="checkbox-inline"
                        >
                            <input type="radio" name="weixin_account_role[]" value="base" checked="checked" /> <?php _e('普通订阅号'); ?>
                        </label>

                        <label class="checkbox-inline">
                            <input type="radio" name="weixin_account_role[]" value="subscription" /> <?php _e('微信认证订阅号'); ?>
                        </label>

                        <label class="checkbox-inline">
                            <input type="radio" name="weixin_account_role[]" value="general" /> <?php _e('普通服务号'); ?>
                        </label>

                        <label class="checkbox-inline">
                            <input type="radio" name="weixin_account_role[]" value="service" /> <?php _e('微信认证服务号'); ?>
                        </label>
                    </div>
                </div>
            </td>
        </tr>

        <tr>
            <td>
                <div class="form-group">
                    <span class="col-sm-4 col-xs-3 control-label"><?php _e('WeCenter 微信服务 Access token'); ?>:</span>
                    <div class="col-sm-5 col-xs-8">
                        <input type="text" class="form-control" name="wecenter_access_token[]" value="">
                        <span class="help-block"><?php _e('请到 %s 申请', '<a href="http://mp.wecenter.com" target="_blank">http://mp.wecenter.com</a>'); ?></span>
                    </div>
                </div>
            </td>
        </tr>

        <tr>
            <td>
                <div class="form-group">
                    <span class="col-sm-4 col-xs-3 control-label"><?php _e('WeCenter 微信服务 Access token'); ?>:</span>
                    <div class="col-sm-5 col-xs-8">
                        <input type="text" class="form-control" name="wecenter_access_token[]" value="">
                    </div>
                </div>
            </td>
        </tr>

        <tr>
            <td>
                <div class="form-group">
                    <span class="col-sm-4 col-xs-3 control-label"><?php _e('WeCenter 微信服务 Access secret'); ?>:</span>
                    <div class="col-sm-5 col-xs-8">
                        <input type="text" class="form-control" name="wecenter_access_secret[]" value="">
                    </div>
                </div>
            </td>
        </tr>

        <tr>
            <td>
                <div class="form-group">
                    <span class="col-sm-4 col-xs-3 control-label"><?php _e('微信公众平台 AppID'); ?>:</span>
                    <div class="col-sm-5 col-xs-8">
                        <input type="text" class="form-control" name="weixin_app_id[]" value="">
                    </div>
                </div>
            </td>
        </tr>

        <tr>
            <td>
                <div class="form-group">
                    <span class="col-sm-4 col-xs-3 control-label"><?php _e('微信公众平台 AppSecret'); ?>:</span>
                    <div class="col-sm-5 col-xs-8">
                        <input type="text" class="form-control" name="weixin_app_secret[]" value="">
                    </div>
                </div>
            </td>
        </tr>
    </table>
</div>
</div>
</div>

<script>
    $(function(){
        var oHtml = $(".wechat-hide").html();
        var num = ($('.wechat').length);

        $('#newChat').click(function(){

            var url = ['<div class="aw-content-wrap wechat wechat' , num+2  , '"','>' , '</div>'].join("");

            var oParent = $(url);
            var oChat = oParent.append(oHtml);
            var oName = '.wechat'+(num + 1);
            var oId = '.wechat'+(num + 2);
            num++

            $(oName).after(oChat);


            $(oId).find('.form-control').attr("name",'weixin_app_secret['+ (num-1) +']');
            $(oId).find('.mod-head').find('input').attr("name",'id['+ (num-1) +']');

            $(oId).find(".pull-left").html('微信帐号  '+(num));
        });
    });

    <?php if ($this->accounts_total == 0) { ?>
    window.onload= function(){
        $('#newChat').click();
    }
    <?php } ?>
</script>

<?php TPL::output('admin/global/footer.tpl.htm'); ?>