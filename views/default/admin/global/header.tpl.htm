<!DOCTYPE HTML>
<html>

<head>
<meta charset="utf-8" />
<meta name="renderer" content="webkit" />
<meta http-equiv="X-UA-Compatible" content="<?php echo X_UA_COMPATIBLE; ?>" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="blank" />
<meta name="format-detection" content="telephone=no" />
<title><?php echo $this->page_title; ?></title>
<base href="<?php echo get_setting('base_url');?>/<?php echo G_INDEX_SCRIPT; ?>" />
<link type="text/css" rel="stylesheet" href="<?php echo G_STATIC_URL; ?>/css/bootstrap.css?v=<?php echo G_VERSION_BUILD; ?>" />
<link type="text/css" rel="stylesheet" href="<?php echo G_STATIC_URL; ?>/css/font-awesome.css?v=<?php echo G_VERSION_BUILD; ?>" />
<script type="text/javascript">
    var G_INDEX_SCRIPT = "<?php echo G_INDEX_SCRIPT; ?>";
    var G_BASE_URL = "<?php echo get_setting('base_url'); ?>/<?php echo rtrim(G_INDEX_SCRIPT, '/'); ?>";
    var G_STATIC_URL = "<?php echo G_STATIC_URL; ?>";
    var G_UPLOAD_URL = "<?php echo get_setting('upload_url'); ?>";
    var G_USER_ID = <?php echo $this->user_id; ?>;
    var G_POST_HASH = "";
</script>
<?php if (is_array($this->_import_css_files)) { ?>
<?php foreach ($this->_import_css_files AS $import_css) { ?>
<link type="text/css" rel="stylesheet" href="<?php echo $import_css; ?>?v=<?php echo G_VERSION_BUILD; ?>" />
<?php } ?>
<?php } ?>
<?php if (is_array($this->_import_js_files)) { ?>
<?php foreach ($this->_import_js_files AS $import_js) { ?>
<script type="text/javascript" src="<?php echo $import_js; ?>?v=<?php echo G_VERSION_BUILD; ?>" ></script>
<?php } ?>
<?php } ?>
<!--[if lte IE 8]>
    <script type="text/javascript" src="<?php echo G_STATIC_URL; ?>/js/respond.js"></script>
<![endif]-->
</head>

<body>
<div  class="aw-header">
    <button class="btn btn-sm mod-head-btn pull-left">
        <i class="fa fa-bars fa-2x"></i>
    </button>

    <div class="mod-header-user">
        <ul class="pull-right">
            <?php $notifications = get_setting('admin_notifications');
            if (!empty($notifications)) {
                if ($notifications['answer_approval']) {
                    $notifications_texts[] = array(
                                                    'url' => 'admin/approval/list/',
                                                    'text' => AWS_APP::lang()->_t('有 %s 个回答待审核。', $notifications['answer_approval'])
                                                );
                }

                if ($notifications['question_approval']) {
                    $notifications_texts[] = array(
                                                    'url' => 'admin/approval/list/type-answer',
                                                    'text' => AWS_APP::lang()->_t('有 %s 个问题待审核。', $notifications['question_approval'])
                                                );
                }

                if ($notifications['article_approval']) {
                    $notifications_texts[] = array(
                                                    'url' => 'admin/approval/list/type-article',
                                                    'text' => AWS_APP::lang()->_t('有 %s 篇文章待审核。', $notifications['article_approval'])
                                                );
                }

                if ($notifications['article_comment_approval']) {
                    $notifications_texts[] = array(
                                                    'url' => 'admin/approval/list/type-article_comment',
                                                    'text' => AWS_APP::lang()->_t('有 %s 个文章评论待审核。', $notifications['article_comment_approval'])
                                                );
                }

                if ($notifications['weibo_msg_approval']) {
                    $notifications_texts[] = array(
                                                    'url' => 'admin/approval/list/type-weibo_msg',
                                                    'text' => AWS_APP::lang()->_t('有 %s 个新浪微博消息待审核。', $notifications['weibo_msg_approval'])
                                                );
                }

                if ($notifications['user_report']) {
                    $notifications_texts[] = array(
                                                    'url' => 'admin/question/report_list/',
                                                    'text' => AWS_APP::lang()->_t('有 %s 个用户举报待查看。', $notifications['user_report'])
                                                );
                }

                if (get_setting('register_valid_type') == 'approval' AND $notifications['register_approval']) {
                    $notifications_texts[] = array(
                                                    'url' => 'admin/user/register_approval_list/',
                                                    'text' => AWS_APP::lang()->_t('有 %s 个新用户待审核。', $notifications['register_approval'])
                                                );
                }

                if ($notifications['verify_approval']) {
                    $notifications_texts[] = array(
                                                    'url' => 'admin/verify_approval_list',
                                                    'text' => AWS_APP::lang()->_t('有 %s 个认证申请待审核。', $notifications['verify_approval'])
                                                );
                }

                if ($this->user_info['group_id'] == 1 AND $notifications['last_version_build_day'] > G_VERSION_BUILD) {
                    $notifications_texts[] = array(
                                                    'url' => 'http://www.wecenter.com/downloads/',
                                                    'text' => AWS_APP::lang()->_t('程序需要更新，最新版本为 %s。', $notifications['last_version'])
                                                );
                }

                if (get_setting('weibo_msg_enabled') == 'Y' AND $notifications['sina_users']) {
                    foreach ($notifications['sina_users'] AS $sina_user) {
                        $notifications_texts[] = array(
                                                        'url' => 'admin/settings/category-openid',
                                                        'text' => AWS_APP::lang()->_t('用户 %s 的新浪微博账号需要更新 Access Token，请重新授权。', $sina_user['user_name'])
                                                    );
                    }
                }
            } ?>
            <li class="dropdown">
                <a href="#" class="dropdown-toggle mod-bell" data-toggle="dropdown">
                    <i class="fa fa-bell"></i>
                    <?php if ($notifications_texts) { ?><span class="label label-danger"><?php echo count($notifications_texts); ?></span><?php } ?>
                </a>

                <ul class="dropdown-menu mod-chat">
                    <?php if ($notifications_texts) { foreach ($notifications_texts AS $notifications_text) { ?>

                    <li class="mod-media">
                        <div class="media-body">
                            <a href="<?php echo $notifications_text['url']; ?>"><p class="margin-none"><?php echo $notifications_text['text']; ?></p></a>
                        </div>
                    </li>
                    <?php } } else { ?>
                    <p><?php _e('没有通知。'); ?></p>
                    <?php } ?>
                </ul>
            </li>

            <li class="dropdown username">
                <a href="" class="dropdown-toggle" data-toggle="dropdown">
                    <img src="<?php echo get_avatar_url($this->user_info['uid'], 'mid'); ?>" class="img-circle" width="30">
                    <?php echo $this->user_info['user_name']; ?>
                    <span class="caret"></span>
                </a>

                <ul class="dropdown-menu pull-right mod-user">
                    <li>
                        <a href="admin/"><i class="fa fa-user"></i><?php _e('报告'); ?></a>
                    </li>

                    <li>
                        <a href="account/setting/profile/"><i class="fa fa-cogs"></i><?php _e('设置'); ?></a>
                    </li>

                    <li>
                        <a href="admin/logout/"><i class="fa fa-reply"></i><?php _e('退出'); ?></a>
                    </li>
                </ul>
            </li>
        </ul>
    </div>
</div>
