<?php TPL::output('global/header.tpl.htm'); ?>
<div class="aw-container-wrap aw-work-wrap">
	<?php TPL::output('block/content_nav_menu.tpl.htm'); ?>

	<div class="container">
		<div class="row">
			<div class="aw-content-wrap clearfix">
				<!-- 侧边栏 -->
				<div class="col-sm-12 col-md-3 aw-side-bar hidden-xs hidden-sm">
					<div class="aw-mod side-nav">
						<h2><i class="icon icon-order"></i>工单</h2>
						<ul>
							<li>
								<a class="active">我的待处理工单<span class="badge">23</span></a>
							</li>
							<li>
								<a>未分配工单</a>
							</li>
							<li>
								<a>所有待处理工单</a>
							</li>
							<li><a>所有工单</a></li>
							<li><a >全部人可见工单</a></li>
						</ul>
					</div>
					<div class="aw-mod side-nav">
						<h2><i class="icon icon-count"></i>统计分析</h2>
						<ul>
							<li>
								<a>综合数据表</a>
							</li>
							<li>
								<a>业绩报表</a>
							</li>
							<li>
								<a>热门话题</a>
							</li>
						</ul>
					</div>
					<div class="aw-mod side-nav">
						<h2><i class="icon icon-job"></i>管理中心</h2>
						<ul>
							<li>
								<a>渠道管理</a>
							</li>
							<li>
								<a>客服组管理</a>
							</li>
						</ul>
					</div>
				</div>
				<!-- end 侧边栏 -->

				<div class="col-sm-12 col-md-9 aw-main-content">
					<h1 class="pull-lrft">
						<i class="icon icon-count"></i> 综合数据表
					</h1>
					<div class="row">
						<div class="col-sm-12">
							<div class="aw-mod title-mod count">
								<div class="mod-head">
									<h3>工单统计</h3>
								</div>
								<div class="mod-body" style="height:350px;"></div>
								<div class="mod-footer">
									
								</div>
							</div>
						</div>
						<div class="col-sm-6">
							<div class="aw-mod title-mod source">
								<div class="mod-head">
									<h3>工单来源统计</h3>
								</div>
								<div class="mod-body" style="height:250px;"></div>
							</div>
						</div>
						<div class="col-sm-6">
							<div class="aw-mod title-mod reply-time">
								<div class="mod-head">
									<h3>首次回复时间</h3>
								</div>
								<div class="mod-body" style="height:250px;"></div>
							</div>
						</div>
						<div class="col-sm-6">
							<div class="aw-mod title-mod consuming">
								<div class="mod-head">
									<h3>结单耗时</h3>
								</div>
								<div class="mod-body" style="height:250px;"></div>
							</div>
						</div>
						<div class="col-sm-6">
							<div class="aw-mod title-mod agent">
								<div class="mod-head">
									<h3>代理月度报表（处理工单数）</h3>
								</div>
								<div class="mod-body" style="height:250px;"></div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script src="<?php echo G_STATIC_URL; ?>/admin/js/echarts.js"></script>
<script>
	$(function()
	{
		// 工单统计
		$.get(G_BASE_URL + '/ticket/ajax/ticket_statistic/', {
			'days' : 30
		}, function (result)
		{
			var chart = echarts.init($('.count .mod-body')[0]);
			var option = {
				animation: false,
				addDataAnimation: false,
				tooltip : {
			        trigger: 'item',
			        formatter: "{b} <br>{a} : {c} " //({d}%)
			    },
				grid: {
		            x: 45,
		            y: 65,
		            x2: 15,
		            y2: 35,
		            backgroundColor: '#fff',
		            borderColor: '#fff'
		        },
				calculable: false,
			    legend: {
			        data:['新建工单','已解决工单','待办工单','互动次数']
			    },
			    calculable : true,
			    xAxis : [
			        {
			            type : 'category',
			            boundaryGap : false,
			            data : result.labels
			        }
			    ],
			    yAxis : [
			        {
			            type : 'value',
			            splitLine: {
			                show: false,
			            },

			            axisLine: {
			                show: false
			            },

			            splitLine: {
			                show: true,
			                lineStyle: {
			                    color: 'rgba(0,0,0,0.1)',
			                    type: 'dashed',
			                    width: 1
			                }
			            }
			        }
			    ],
			    series : [
			        {
			            name:'新建工单',
			            type:'line',
			            stack: '总量',
			            symbol: 'none',
			            temStyle: {
	                        normal: {
	                            lineStyle: {
	                                width: 4,
	                            }
	                        },
	                    },
			            data:result.data[0]
			        },
			        {
			            name:'已解决工单',
			            type:'line',
			            stack: '总量',
			            symbol: 'none',
			            temStyle: {
	                        normal: {
	                            lineStyle: {
	                                width: 4,
	                            }
	                        },
	                    },
			            data:result.data[1]
			        },
			        {
			            name:'待办工单',
			            type:'line',
			            stack: '总量',
			            symbol: 'none',
			            temStyle: {
	                        normal: {
	                            lineStyle: {
	                                width: 4,
	                            }
	                        },
	                    },
			            data:result.data[2]
			        },
			        {
			            name:'互动次数',
			            type:'line',
			            stack: '总量',
			            symbol: 'none',
			            temStyle: {
	                        normal: {
	                            lineStyle: {
	                                width: 4,
	                            }
	                        },
	                    },
			            data:result.data[3]
			        }
			    ]
			};
			chart.setOption(option);
		}, 'json');

		//var echart1 = new Echarts('.count .mod-body', 'line', G_BASE_URL + '/ticket_statistic?days=30');


		// 工单来源统计
		$.get(G_BASE_URL + '/ticket/ajax/ticket_source_statistic/', {
			'days' : 30
		}, function (result)
		{
			// 工单来源统计
			var chart = echarts.init($('.source .mod-body')[0]);
			var option = {
			    tooltip : {
			        trigger: 'item',
			        formatter: "{a}{b} : {c} " //({d}%)
			    },
			    legend: {
			        orient : 'vertical',
			        x : 'left',
			        data:['本站','微博','微信','E-mail']
			    },
			    toolbox: {
			        show : false,
			        feature : {
			            mark : {show: true},
			            dataView : {show: true, readOnly: false},
			            restore : {show: true},
			            saveAsImage : {show: true}
			        }
			    },
			    calculable : true,
			    series : [
			        {
			        	name: '来自',
			            type:'pie',
			            radius : ['50%', '70%'],
			            itemStyle : {
			                normal : {
			                    label : {
			                        show : false
			                    },
			                    labelLine : {
			                        show : false
			                    }
			                },
			                emphasis : {
			                    label : {
			                        show : true,
			                        position : 'center',
			                        textStyle : {
			                            fontSize : '30',
			                            fontWeight : 'bold'
			                        }
			                    }
			                }
			            },
			            data:[
			                {value:result.data[0], name:'本站'},
			                {value:result.data[1], name:'微博'},
			                {value:result.data[2], name:'微信'},
			                {value:result.data[3], name:'E-mail'}
			            ]
			        }
			    ]
			};
	        chart.setOption(option);
		}, 'json');

		// 首次回复时间
		$.get(G_BASE_URL + '/ticket/ajax/first_reply_statistic/', {
			'days' : 30
		}, function (result)
		{
	        var chart = echarts.init($('.reply-time .mod-body')[0]);
	        var option = {
			    tooltip : {
			        trigger: 'axis'
			    },
			    calculable : true,
			    xAxis : [
			        {
			            type : 'category',
			            data : ['0-1小时','1-8小时','8-24小时','>24小时']
			        }
			    ],
			    yAxis : [
			        {
			            type : 'value'
			        }
			    ],
			    series : [
			        {
			            name:'得到首次回复的工单',
			            type:'bar',
			            data: result.data
			        }
			    ]
			};
			chart.setOption(option);
		}, 'json');

		// 结单耗时
		$.get(G_BASE_URL + '/ticket/ajax/end_ticket_statistic/', {
			'days' : 30
		}, function (result)
		{
	        var chart = echarts.init($('.consuming .mod-body')[0]);
	        var option = {
			    tooltip : {
			        trigger: 'axis'
			    },
			    toolbox: {
			        show : false,
			        feature : {
			            mark : {show: true},
			            dataView : {show: true, readOnly: false},
			            magicType : {show: true, type: ['line', 'bar']},
			            restore : {show: true},
			            saveAsImage : {show: true}
			        }
			    },
			    calculable : true,
			    xAxis : [
			        {
			            type : 'category',
			            data : ['0-6小时','6-24小时','24-48小时','>48小时']
			        }
			    ],
			    yAxis : [
			        {
			            type : 'value'
			        }
			    ],
			    series : [
			        {
			            name:'结束的工单',
			            type:'bar',
			            data:result.data
			        }
			    ]
			};
			chart.setOption(option);
		}, 'json');

		// 代理月度报表
		$.get(G_BASE_URL + '/ticket/ajax/end_ticket_statistic/', {
			'days' : 30
		}, function (result)
		{
			var chart = echarts.init($('.agent .mod-body')[0]);
	        var option = {
			    tooltip : {
			        trigger: 'item',
			        formatter: "{b} <br>{a} : {c} " //({d}%)
			    },
			    toolbox: {
			        show : false,
			        feature : {
			            mark : {show: true},
			            dataView : {show: true, readOnly: false},
			            magicType : {show: true, type: ['line', 'bar']},
			            restore : {show: true},
			            saveAsImage : {show: true}
			        }
			    },
			    calculable : true,
			    xAxis : [
			        {
			            type : 'category',
			            data : ['1月','2月','3月','4月','5月','6月','7月','8月','9月','10月','11月','12月']
			        }
			    ],
			    yAxis : [
			        {
			            type : 'value'
			        }
			    ],
			    series : [
			        {
			            name:'处理工单',
			            type:'bar',
			            data:[2.0, 4.9, 7.0, 23.2, 25.6, 76.7, 135.6, 162.2, 32.6, 20.0, 6.4, 3.3]
			        },
			        {
			            name:'处理工单',
			            type:'bar',
			            data:[2.0, 4.9, 7.0, 23.2, 25.6, 76.7, 135.6, 162.2, 32.6, 20.0, 6.4, 3.3]
			        }
			    ]
			};
			chart.setOption(option);
		}, 'json');
        
                    
	});
</script>

<?php TPL::output('global/footer.tpl.htm'); ?>