<?php TPL::output('global/header.tpl.htm'); ?>
<div class="aw-container-wrap aw-work-wrap">
    <?php TPL::output('block/content_nav_menu.tpl.htm'); ?>

    <div class="container">
        <div class="row">
            <div class="aw-content-wrap clearfix">
                <!-- 侧边栏 -->
                <div class="col-sm-12 col-md-3 aw-side-bar hidden-xs hidden-sm">
                    <div class="aw-mod side-nav">
                        <h2><i class="icon icon-order"></i><?php _e('工单'); ?></h2>
                        <ul>
                            <li>
                                <a href="ticket/service-me__status-pending"><?php _e('我的待处理工单'); ?><span class="badge"><?php echo $this->my_pending_tickets; ?></span></a>
                            </li>
                            <li>
                                <a href="ticket/service-0__status-pending"><?php _e('未分配工单'); ?></a>
                            </li>
                            <li>
                                <a href="ticket/status-pending"><?php _e('所有待处理工单'); ?></a>
                            </li>
                            <li>
                                <a href="ticket/"><?php _e('所有工单'); ?></a>
                            </li>
                        </ul>
                    </div>

                    <?php if ($this->user_info['permission']['is_administortar']) { ?>
                    <div class="aw-mod side-nav">
                        <h2><i class="icon icon-count"></i><?php _e('统计分析'); ?></h2>
                        <ul>
                            <li>
                                <a href="ticket/data/" class="active"><?php _e('综合数据表'); ?></a>
                            </li>
                            <li>
                                <a href="ticket/data/"><?php _e('业绩报表'); ?></a>
                            </li>
                            <li>
                                <a href="ticket/topic/"><?php _e('热门话题'); ?></a>
                            </li>
                        </ul>
                    </div>

                    <div class="aw-mod side-nav">
                        <h2><i class="icon icon-job"></i><?php _e('管理中心'); ?></h2>
                        <ul>
                            <li>
                                <a><?php _e('渠道管理'); ?></a>
                            </li>
                            <li>
                                <a><?php _e('客服组管理'); ?></a>
                            </li>
                        </ul>
                    </div>
                    <?php } ?>
                </div>
                <!-- end 侧边栏 -->

                <div class="col-sm-12 col-md-9 aw-main-content">
                    <h1 class="pull-lrft">
                        <i class="icon icon-count"></i> <?php _e('综合数据表'); ?>
                    </h1>
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="aw-mod title-mod count">
                                <div class="mod-head">
                                    <h3><?php _e('工单统计'); ?></h3>
                                </div>
                                <div class="mod-body" style="height:350px;"></div>
                                <div class="mod-footer clearfix">
									<ul>
										<li>
											<b><?php echo $this->pending_tickets_count; ?></b>
											<?php _e('待办工单'); ?>
										</li>
										<li>
											<b><?php echo $this->closed_tickets_count; ?></b>
											<?php _e('已解决工单'); ?>
										</li>
										<li>
											<b><?php echo $this->tickets_count; ?></b>
											<?php _e('工单总量'); ?>
										</li>
										<li>
											<b><?php echo $this->users_count; ?></b>
											<?php _e('客户'); ?>
										</li>
									</ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="aw-mod title-mod source">
                                <div class="mod-head">
                                    <h3><?php _e('工单来源统计'); ?></h3>
                                </div>
                                <div class="mod-body" style="height:250px;"></div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="aw-mod title-mod reply-time">
                                <div class="mod-head">
                                    <h3><?php _e('首次回复时间'); ?></h3>
                                </div>
                                <div class="mod-body" style="height:250px;"></div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="aw-mod title-mod consuming">
                                <div class="mod-head">
                                    <h3><?php _e('结单耗时'); ?></h3>
                                </div>
                                <div class="mod-body" style="height:250px;"></div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="aw-mod title-mod agent">
                                <div class="mod-head">
                                    <h3><?php _e('代理月度报表（处理工单数）'); ?></h3>
                                </div>
                                <div class="mod-body" style="height:250px;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="<?php echo G_STATIC_URL; ?>/admin/js/echarts.js"></script>
<script>
    $(function()
    {
        // 工单统计
        $.get(G_BASE_URL + '/ticket/ajax/ticket_statistic/', {
            'days' : 7
        }, function (result)
        {
			var chart = echarts.init($('.count .mod-body')[0]);
			var option = {
				animation: false,
				addDataAnimation: false,
				tooltip : {
					show: true,
					showContent: true,
			        trigger: 'item',
			        formatter: "{b} <br>{a} : {c} " //({d}%)
			    },
			    calculable : true,
			    color: ['#66b7ff', '#999999', '#79cc47', '#ffaa00'],
				grid: {
		            x: 50,
		            y: 65,
		            x2: 150,
		            y2: 50,
		            backgroundColor: '#fff',
		            borderColor: '#fff'
		        },
			    legend: {
			        data:['<?php _e("新建工单"); ?>','<?php _e("已解决工单"); ?>','<?php _e("待办工单"); ?>','<?php _e("互动次数"); ?>'],
			        orient : 'vertical',
			        x : 'right',
			        y : 'center',
			        padding: 15
			    },
			    xAxis : [
			        {
			            type : 'category',
			            boundaryGap : false,
			            data : result.labels,
			            splitLine: {
			                show: false
			            },
			            nameTextStyle: {
			            	color: 'red'
			            }
			        }
			    ],
			    yAxis : [
			        {
			            type : 'value',
			            splitLine: {
			                show: true
			            }
			        }
			    ],
			    series : [
			        {
			            name:'<?php _e("新建工单"); ?>',
			            type:'line',
			            symbol: 'none',
			            itemStyle: {
	                        normal: {
	                            lineStyle: {
	                                width: 2,
	                                color: '#66b7ff'
	                            }
	                        },
	                    },
			            data:result.data[0]
			        },
			        {
			            name:'<?php _e("已解决工单"); ?>',
			            type:'line',
			            symbol: 'none',
			            itemStyle: {
	                        normal: {
	                            lineStyle: {
	                                width: 2,
	                                color: '#999999'
	                            }
	                        },
	                    },
			            data:result.data[1]
			        },
			        {
			            name:'<?php _e("待办工单"); ?>',
			            type:'line',
			            symbol: 'none',
			            itemStyle: {
	                        normal: {
	                            lineStyle: {
	                                width: 2,
	                                color: '#79cc47'
	                            }
	                        },
	                    },
			            data:result.data[2]
			        },
			        {
			            name:'<?php _e("互动次数"); ?>',
			            type:'line',
			            symbol: 'none',
			            itemStyle: {
	                        normal: {
	                            lineStyle: {
	                                width: 2,
	                                color: '#ffaa00'
	                            }
	                        },
	                    },
			            data:result.data[3]
			        }
			    ]
			};
			chart.setOption(option);
		}, 'json');

        // 工单来源统计
        $.get(G_BASE_URL + '/ticket/ajax/ticket_source_statistic/', {
            'days' : 30
        }, function (result)
        {
            // 工单来源统计
            var chart = echarts.init($('.source .mod-body')[0]);
            var option = {
                tooltip : {
                    trigger: 'item',
                    formatter: "{a}{b} : {c} " //({d}%)
                },
                legend: {
                    orient : 'vertical',
                    x : 'right',
                    y : 'center',
                    data:["<?php _e('本站'); ?>", "<?php _e('微博'); ?>", "<?php _e('微信'); ?>", "<?php _e('邮件'); ?>"]
                },
                color: ['#999999', '#ff7373', '#79cc47', '#66b7ff'],
                toolbox: {
                    show : false,
                    feature : {
                        mark : {show: true},
                        dataView : {show: true, readOnly: false},
                        restore : {show: true},
                        saveAsImage : {show: true}
                    }
                },
                calculable : true,
                series : [
                    {
                        name: "<?php _e('来自'); ?>",
                        type:'pie',
                        itemStyle : {
                            normal : {
                                label : {
                                    show : false
                                },
                                labelLine : {
                                    show : false
                                }
                            },
                            emphasis : {
                                label : {
                                    show : true,
                                    position : 'center',
                                    textStyle : {
                                        fontSize : '30',
                                        fontWeight : 'bold'
                                    }
                                }
                            }
                        },
                        data:[
                            {value:result.data[0], name:"<?php _e('本站'); ?>"},
                            {value:result.data[1], name:"<?php _e('微博'); ?>"},
                            {value:result.data[2], name:"<?php _e('微信'); ?>"},
                            {value:result.data[3], name:"<?php _e('邮件'); ?>"}
                        ]
                    }
                ]
            };
            chart.setOption(option);
        }, 'json');

        // 首次回复时间
        $.get(G_BASE_URL + '/ticket/ajax/first_reply_statistic/', {
            'days' : 30
        }, function (result)
        {
            var chart = echarts.init($('.reply-time .mod-body')[0]);
            var option = {
                tooltip : {
                    trigger: 'axis'
                },
                color: ['#66b7ff'],
                calculable : true,
                xAxis : [
                    {
                        type : 'category',
                        data : ["<?php _e('0-1小时'); ?>", "<?php _e('1-8小时'); ?>", "<?php _e('8-24小时'); ?>", "<?php _e('>24小时'); ?>"],
                        splitLine: {
			                show: false
			            }
                    }
                ],
                yAxis : [
                    {
                        type : 'value'
                    }
                ],
                series : [
                    {
                        name:"<?php _e('得到首次回复的工单'); ?>",
                        type:'bar',
                        data: result.data
                    }
                ]
            };
            chart.setOption(option);
        }, 'json');

        // 结单耗时
        $.get(G_BASE_URL + '/ticket/ajax/end_ticket_statistic/', {
            'days' : 30
        }, function (result)
        {
            var chart = echarts.init($('.consuming .mod-body')[0]);
            var option = {
                tooltip : {
                    trigger: 'axis'
                },
                toolbox: {
                    show : false,
                    feature : {
                        mark : {show: true},
                        dataView : {show: true, readOnly: false},
                        magicType : {show: true, type: ['line', 'bar']},
                        restore : {show: true},
                        saveAsImage : {show: true}
                    }
                },
                grid: {
		            x: 50,
		            y: 65,
		            x2: 50,
		            y2: 50,
		            backgroundColor: '#fff',
		            borderColor: '#fff'
		        },
                color: ['#79cc47'],
                calculable : true,
                xAxis : [
                    {
                        type : 'category',
                        data : ["<?php _e('0-6小时'); ?>", "<?php _e('6-24小时'); ?>", "<?php _e('24-48小时'); ?>", "<?php _e('>48小时'); ?>"],
                        splitLine: {
			                show: false
			            }
                    }
                ],
                yAxis : [
                    {
                        type : 'value'
                    }
                ],
                series : [
                    {
                        name:"<?php _e('结束的工单'); ?>",
                        type:'bar',
                        data:result.data
                    }
                ]
            };
            chart.setOption(option);
        }, 'json');

        // 代理月度报表
        $.get(G_BASE_URL + '/ticket/ajax/end_ticket_statistic/', {
            'days' : 30
        }, function (result)
        {
            var chart = echarts.init($('.agent .mod-body')[0]);
            var option = {
                tooltip : {
                    trigger: 'item',
                    formatter: "{b} <br>{a} : {c} " //({d}%)
                },
                color: ['#79cc47', '#66b7ff'],
                toolbox: {
                    show : false,
                    feature : {
                        mark : {show: true},
                        dataView : {show: true, readOnly: false},
                        magicType : {show: true, type: ['line', 'bar']},
                        restore : {show: true},
                        saveAsImage : {show: true}
                    }
                },
                calculable : true,
                xAxis : [
                    {
                        type : 'category',
                        data : ["<?php _e('1月'); ?>", "<?php _e('2月'); ?>", "<?php _e('3月'); ?>", "<?php _e('4月'); ?>", "<?php _e('5月'); ?>", "<?php _e('6月'); ?>", "<?php _e('7月'); ?>", "<?php _e('8月'); ?>", "<?php _e('9月'); ?>", "<?php _e('10月'); ?>", "<?php _e('11月'); ?>", "<?php _e('12月'); ?>"]
                    }
                ],
                yAxis : [
                    {
                        type : 'value'
                    }
                ],
                series : [
                    {
                        name:"<?php _e('处理工单'); ?>",
                        type:'bar',
                        data:[2.0, 4.9, 7.0, 23.2, 25.6, 76.7, 135.6, 162.2, 32.6, 20.0, 6.4, 3.3]
                    },
                    {
                        name:"<?php _e('处理工单'); ?>",
                        type:'bar',
                        data:[2.0, 4.9, 7.0, 23.2, 25.6, 76.7, 135.6, 162.2, 32.6, 20.0, 6.4, 3.3]
                    }
                ]
            };
            chart.setOption(option);
        }, 'json');


    });
</script>

<?php TPL::output('global/footer.tpl.htm'); ?>