/*+--------------------------------------+* 名称: global* 功能: 相关效果处理* anwsin官方:http://www.anwsion.com/* developer:诸葛浮云* Email:globalbreak@gmail.com * Copyright © 2012 - Anwsion社区, All Rights Reserved * Date:2012-08-01*+--------------------------------------+*/(function($){	$.fn.insertAtCaret = function(textFeildValue){ 			var textObj = $(this).get(0); 			if(document.all && textObj.createTextRange && textObj.caretPos){ 				var caretPos=textObj.caretPos; 				caretPos.text = caretPos.text.charAt(caretPos.text.length-1) == '' ? 					textFeildValue+'' : textFeildValue; 			} 			else if(textObj.setSelectionRange){ 				var rangeStart=textObj.selectionStart; 				var rangeEnd=textObj.selectionEnd; 				var tempStr1=textObj.value.substring(0,rangeStart); 				var tempStr2=textObj.value.substring(rangeEnd); 				textObj.value=tempStr1+textFeildValue+tempStr2; 				textObj.focus(); 				var len=textFeildValue.length; 				textObj.setSelectionRange(rangeStart+len,rangeStart+len); 				textObj.blur(); 			} 			else { 				textObj.value+=textFeildValue; 			} 	} //		$.extend({		//插入操作		addTextpicTure:function(){			var textFeildValue = '\n!['+($('#addTxtForms :input[name="imgsAlt"]').val())+']('+$('#addTxtForms :input[name="imgsUrl"]').val()+')';			$('#advanced_editor') == null ? '' :			$('#advanced_editor').insertAtCaret(textFeildValue),$('#closeDefault').click();			},				//插入视频操作		addVideo:function(){			if ($('#addTxtForms :input[name="videoUrl"]').val().indexOf('.swf') != -1)			{				alert(_t('请输入视频网站页面地址, 不是播放器地址'));								return false;			}									var textFeildValue = '\n!!['+($('#addTxtForms :input[name="videoTitle"]').val())+']('+$('#addTxtForms :input[name="videoUrl"]').val()+')';			$('#advanced_editor') == null ? '' :			$('#advanced_editor').insertAtCaret(textFeildValue), $('#closeDefault').click();		},		// 设置编辑器预览状态		setEditorPreview:function(){			if ($.cookie('data_editor_preview') != 'false')			{    			$('.markItUpButton11 a').addClass('cur');			}			else			{            	$('#markItUpPreviewFrame').toggle();			}		},		// 向编辑器中插入文本		insertIntoCodemirror : function(fn){			var flag = false;            var pos = {};            var cursor = 0;            var textarea = document.getElementById('advanced_editor');            if (advanced_editor != null) {                            pos = advanced_editor.getCursor('start');                                advanced_editor.toTextArea();                                for(var i = 0, iLen = pos.line; i < iLen; i++){                    cursor += advanced_editor.lineInfo(i).text.length + 1;                }                                cursor += pos.ch;				if (textarea.createTextRange){					// quick fix to make it work on Opera 9.5					if ($.browser.opera && $.browser.version >= 9.5 && advanced_editor.getSelection().length == 0) {						return false;					}					range = textarea.createTextRange();					range.collapse(true);					range.moveStart('character', cursor); 					range.moveEnd('character', advanced_editor.getSelection().length); 					range.select();				} else if (textarea.setSelectionRange ){					textarea.setSelectionRange(cursor, cursor + advanced_editor.getSelection().length);				}				textarea.focus();                advanced_editor = null;                flag = true;            }                    fn(arguments[1]);            if(flag){                                               advanced_editor = CodeMirror.fromTextArea(textarea, {                    mode: 'markdown',                    lineNumbers: true,                    theme: "default",                    extraKeys: {"Enter": "newlineAndIndentContinueMarkdownList"}                });                if(typeof arguments[1] != 'undefined' && (arguments[1].offset || arguments[1].addline)){                	pos.line += (arguments[1].addline ? arguments[1].addline : 0);                	pos.ch += (arguments[1].offset ? arguments[1].offset : 0);                }                advanced_editor.setCursor(pos);            }		}			}); //end  extend})(jQuery)